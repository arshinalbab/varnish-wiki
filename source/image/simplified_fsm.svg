<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="685pt" height="968pt" viewBox="0 0 685 968"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 964)"><title>varnishfsm</title><polygon fill="#fff" stroke="none" points="-4 4 -4 -964 681 -964 681 4 -4 4"/><g id="clust1" class="cluster"><title>clusterfrontend</title><polygon fill="none" stroke="#000" points="8 -8 8 -896 669 -896 669 -8 8 -8"/><text x="115" y="-880.8" font-family="Times,serif" font-size="14" text-anchor="middle">Frontend (From Client) Workthread</text></g><g id="clust4" class="cluster"><title>clusterbackend</title><polygon fill="#f0f8ff" stroke="#000" points="62 -166 62 -551 430 -551 430 -166 62 -166"/><text x="162" y="-535.8" font-family="Times,serif" font-size="14" text-anchor="middle">Backend (To Server) Workthread</text></g><g id="node1" class="node"><title>Request</title><polygon fill="none" stroke="#000" points="275 -960 219.776 -942 275 -924 330.224 -942 275 -960"/><polyline fill="none" stroke="#000" points="231.185 -945.719 231.185 -938.281"/><polyline fill="none" stroke="#000" points="263.591 -927.719 286.409 -927.719"/><polyline fill="none" stroke="#000" points="318.815 -938.281 318.815 -945.719"/><polyline fill="none" stroke="#000" points="286.409 -956.281 263.591 -956.281"/><text x="275" y="-938.3" font-family="Times,serif" font-size="14" text-anchor="middle">Request</text></g><g id="node3" class="node"><title>vcl_recv</title><ellipse cx="337" cy="-847" fill="none" stroke="#000" rx="40.42" ry="18"/><text x="337" y="-843.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_recv</text></g><g id="edge1" class="edge"><title>Request-&gt;vcl_recv</title><path fill="none" stroke="#000" d="M284.416,-926.875C293.936,-912.596 308.846,-890.23 320.362,-872.957"/><polygon fill="#000" stroke="#000" points="323.393 -874.72 326.028 -864.458 317.569 -870.837 323.393 -874.72"/></g><g id="node2" class="node"><title>restart1</title><polygon fill="none" stroke="#000" points="399 -960 348.67 -942 399 -924 449.33 -942 399 -960"/><polyline fill="none" stroke="#000" points="359.969 -946.041 359.969 -937.959"/><polyline fill="none" stroke="#000" points="387.701 -928.041 410.299 -928.041"/><polyline fill="none" stroke="#000" points="438.031 -937.959 438.031 -946.041"/><polyline fill="none" stroke="#000" points="410.299 -955.959 387.701 -955.959"/><text x="399" y="-938.3" font-family="Times,serif" font-size="14" text-anchor="middle">Restart</text></g><g id="edge2" class="edge"><title>restart1-&gt;vcl_recv</title><path fill="none" stroke="#000" d="M389.584,-926.875C380.064,-912.596 365.154,-890.23 353.638,-872.957"/><polygon fill="#000" stroke="#000" points="356.431 -870.837 347.972 -864.458 350.607 -874.72 356.431 -870.837"/></g><g id="node9" class="node"><title>vcl_hash</title><ellipse cx="337" cy="-759" fill="none" stroke="#000" rx="42.37" ry="18"/><text x="337" y="-755.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_hash</text></g><g id="edge3" class="edge"><title>vcl_recv-&gt;vcl_hash</title><path fill="none" stroke="#000" d="M337,-828.597C337,-816.746 337,-800.817 337,-787.292"/><polygon fill="#000" stroke="#000" points="340.5 -787.084 337 -777.084 333.5 -787.084 340.5 -787.084"/><text x="356" y="-799.3" font-family="Times,serif" font-size="14" text-anchor="middle">lookup</text></g><g id="node4" class="node"><title>vcl_deliver</title><ellipse cx="150" cy="-118" fill="none" stroke="#000" rx="50.068" ry="18"/><text x="150" y="-114.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_deliver</text></g><g id="node12" class="node"><title>Done</title><polygon fill="none" stroke="#000" points="464 -62 418 -62 418 -16 464 -16 464 -62"/><polyline fill="none" stroke="#000" points="430 -62 418 -50"/><polyline fill="none" stroke="#000" points="418 -28 430 -16"/><polyline fill="none" stroke="#000" points="452 -16 464 -28"/><polyline fill="none" stroke="#000" points="464 -50 452 -62"/><text x="441" y="-35.3" font-family="Times,serif" font-size="14" text-anchor="middle">Done</text></g><g id="edge27" class="edge"><title>vcl_deliver-&gt;Done</title><path fill="none" stroke="#000" d="M188.944,-106.695C246.705,-91.4113 354.063,-63.0039 408.111,-48.7025"/><polygon fill="#000" stroke="#000" points="409.098 -52.062 417.87 -46.12 407.307 -45.295 409.098 -52.062"/></g><g id="node5" class="node"><title>vcl_synth</title><ellipse cx="441" cy="-118" fill="none" stroke="#000" rx="44.271" ry="18"/><text x="441" y="-114.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_synth</text></g><g id="edge28" class="edge"><title>vcl_synth-&gt;Done</title><path fill="none" stroke="#000" d="M441,-99.9112C441,-91.7118 441,-81.6125 441,-72.0581"/><polygon fill="#000" stroke="#000" points="444.5 -72.02 441 -62.02 437.5 -72.02 444.5 -72.02"/></g><g id="node6" class="node"><title>vcl_hit</title><ellipse cx="51" cy="-671" fill="none" stroke="#000" rx="35.145" ry="18"/><text x="51" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_hit</text></g><g id="edge13" class="edge"><title>vcl_hit-&gt;vcl_deliver</title><path fill="none" stroke="#006400" d="M51,-652.834C51,-638.247 51,-616.75 51,-598 51,-598 51,-598 51,-191 51,-179.462 50.6932,-174.93 58,-166 69.6782,-151.727 86.8166,-141.338 103.145,-134.014"/><polygon fill="#006400" stroke="#006400" points="104.744 -137.139 112.618 -130.051 102.042 -130.682 104.744 -137.139"/></g><g id="node11" class="node"><title>vcl_pass</title><ellipse cx="182" cy="-597" fill="none" stroke="#000" rx="40.42" ry="18"/><text x="182" y="-593.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_pass</text></g><g id="edge14" class="edge"><title>vcl_hit-&gt;vcl_pass</title><path fill="none" stroke="red" d="M73.8551,-657.062C86.5364,-649.914 102.609,-640.907 117,-633 127.062,-627.471 138.041,-621.526 148.063,-616.133"/><polygon fill="red" stroke="red" points="149.791 -619.178 156.944 -611.363 146.479 -613.011 149.791 -619.178"/></g><g id="node7" class="node"><title>vcl_miss</title><ellipse cx="305" cy="-671" fill="none" stroke="#000" rx="42.37" ry="18"/><text x="305" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_miss</text></g><g id="edge18" class="edge"><title>vcl_miss-&gt;vcl_pass</title><path fill="none" stroke="red" d="M281.284,-656.118C262.311,-645.012 235.505,-629.32 214.528,-617.041"/><polygon fill="red" stroke="red" points="216.041 -613.871 205.643 -611.84 212.505 -619.912 216.041 -613.871"/></g><g id="node14" class="node"><title>vcl_backend_fetch</title><ellipse cx="243" cy="-502" fill="none" stroke="#000" rx="77.015" ry="18"/><text x="243" y="-498.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_fetch</text></g><g id="edge15" class="edge"><title>vcl_miss-&gt;vcl_backend_fetch</title><path fill="none" stroke="#00f" d="M298.714,-653.068C287.898,-623.936 265.694,-564.126 252.822,-529.455"/><polygon fill="#00f" stroke="#00f" points="256.064 -528.133 249.303 -519.977 249.502 -530.57 256.064 -528.133"/></g><g id="node8" class="node"><title>vcl_purge</title><ellipse cx="411" cy="-671" fill="none" stroke="#000" rx="46.219" ry="18"/><text x="411" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_purge</text></g><g id="edge12" class="edge"><title>vcl_purge-&gt;vcl_synth</title><path fill="none" stroke="purple" d="M422.342,-653.355C430.837,-639.258 441,-618.177 441,-598 441,-598 441,-598 441,-191 441,-176.205 441,-159.7 441,-146.229"/><polygon fill="purple" stroke="purple" points="444.5 -146.166 441 -136.166 437.5 -146.166 444.5 -146.166"/></g><g id="edge7" class="edge"><title>vcl_hash-&gt;vcl_hit</title><path fill="none" stroke="#006400" d="M295.929,-754.993C237.866,-750.22 135.155,-739.701 102,-723 89.2933,-716.599 77.8192,-705.833 68.9868,-695.838"/><polygon fill="#006400" stroke="#006400" points="71.6 -693.507 62.497 -688.086 66.232 -698 71.6 -693.507"/><text x="109.5" y="-711.3" font-family="Times,serif" font-size="14" text-anchor="middle">hit</text></g><g id="edge8" class="edge"><title>vcl_hash-&gt;vcl_miss</title><path fill="none" stroke="#00f" d="M330.678,-741.009C326.164,-728.877 320.003,-712.32 314.847,-698.465"/><polygon fill="#00f" stroke="#00f" points="318.077 -697.107 311.309 -688.956 311.516 -699.548 318.077 -697.107"/><text x="337" y="-711.3" font-family="Times,serif" font-size="14" text-anchor="middle">miss</text></g><g id="edge11" class="edge"><title>vcl_hash-&gt;vcl_purge</title><path fill="none" stroke="purple" d="M350.919,-741.824C362.011,-728.933 377.711,-710.687 390.28,-696.08"/><polygon fill="purple" stroke="purple" points="393.023 -698.259 396.892 -688.396 387.716 -693.693 393.023 -698.259"/><text x="396.5" y="-711.3" font-family="Times,serif" font-size="14" text-anchor="middle">purge</text></g><g id="node10" class="node"><title>vcl_pipe</title><ellipse cx="516" cy="-671" fill="none" stroke="#000" rx="40.42" ry="18"/><text x="516" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_pipe</text></g><g id="edge4" class="edge"><title>vcl_hash-&gt;vcl_pipe</title><path fill="none" stroke="orange" d="M365.693,-745.737C380.759,-739.185 399.476,-730.867 416,-723 438.078,-712.489 462.535,-700.031 481.737,-690.058"/><polygon fill="orange" stroke="orange" points="483.458 -693.108 490.707 -685.382 480.222 -686.901 483.458 -693.108"/><text x="458" y="-711.3" font-family="Times,serif" font-size="14" text-anchor="middle">pipe</text></g><g id="edge5" class="edge"><title>vcl_hash-&gt;vcl_pass</title><path fill="none" stroke="red" d="M296.131,-754.461C262.711,-750.325 214.951,-741.513 177,-723 155.724,-712.621 146.067,-710.426 136,-689 129.196,-674.519 130.54,-668.039 136,-653 140.337,-641.054 148.531,-629.889 156.815,-620.782"/><polygon fill="red" stroke="red" points="159.58 -622.958 164.025 -613.34 154.553 -618.087 159.58 -622.958"/><text x="148" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">pass</text></g><g id="edge9" class="edge"><title>vcl_hash-&gt;vcl_pass</title><path fill="none" stroke="red" d="M299.105,-751.004C264.899,-742.551 216.196,-724.748 191,-689 178.036,-670.606 176.669,-644.682 178.031,-625.206"/><polygon fill="red" stroke="red" points="181.526 -625.43 179.012 -615.138 174.559 -624.751 181.526 -625.43"/><text x="222.5" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">hit-for-pass</text></g><g id="node13" class="node"><title>waiting</title><polygon fill="none" stroke="#000" points="660.17 -671 639.085 -689 596.915 -689 575.83 -671 596.915 -653 639.085 -653 660.17 -671"/><text x="618" y="-667.3" font-family="Times,serif" font-size="14" text-anchor="middle">waiting</text></g><g id="edge10" class="edge"><title>vcl_hash-&gt;waiting</title><path fill="none" stroke="#000" d="M373.303,-749.671C401.06,-743.075 440.18,-733.286 474,-723 510.317,-711.955 551.036,-697.319 579.883,-686.559"/><polygon fill="#000" stroke="#000" points="581.431 -689.717 589.565 -682.928 578.973 -683.163 581.431 -689.717"/><text x="534" y="-711.3" font-family="Times,serif" font-size="14" text-anchor="middle">busy</text></g><g id="edge6" class="edge"><title>vcl_pipe-&gt;Done</title><path fill="none" stroke="orange" d="M513.766,-652.867C512.06,-638.3 510,-616.815 510,-598 510,-598 510,-598 510,-117 510,-92.7169 490.732,-72.5959 472.559,-59.0192"/><polygon fill="orange" stroke="orange" points="474.553 -56.142 464.36 -53.25 470.525 -61.867 474.553 -56.142"/></g><g id="edge17" class="edge"><title>vcl_pass-&gt;vcl_backend_fetch</title><path fill="none" stroke="red" d="M192.906,-579.373C202.158,-565.267 215.583,-544.8 226.207,-528.603"/><polygon fill="red" stroke="red" points="229.218 -530.393 231.776 -520.112 223.365 -526.554 229.218 -530.393"/></g><g id="edge16" class="edge"><title>waiting-&gt;vcl_hash</title><path fill="none" stroke="#000" d="M600.504,-689.188C587.813,-700.623 569.665,-714.968 551,-723 498.707,-745.503 433.522,-753.633 388.922,-756.519"/><polygon fill="#000" stroke="#000" points="388.671 -753.028 378.891 -757.102 389.077 -760.016 388.671 -753.028"/></g><g id="node15" class="node"><title>decision1</title><polygon fill="none" stroke="#000" points="243 -446 124.643 -428 243 -410 361.357 -428 243 -446"/><text x="243" y="-424.3" font-family="Times,serif" font-size="14" text-anchor="middle">read beresp(headers)</text></g><g id="edge19" class="edge"><title>vcl_backend_fetch-&gt;decision1</title><path fill="none" stroke="#000" d="M243,-483.937C243,-475.807 243,-465.876 243,-456.705"/><polygon fill="#000" stroke="#000" points="246.5 -456.441 243 -446.441 239.5 -456.441 246.5 -456.441"/></g><g id="node16" class="node"><title>vcl_backend_response</title><ellipse cx="160" cy="-354" fill="none" stroke="#000" rx="90.014" ry="18"/><text x="160" y="-350.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_response</text></g><g id="edge20" class="edge"><title>decision1-&gt;vcl_backend_response</title><path fill="none" stroke="#000" d="M226.204,-412.43C214.985,-402.698 199.979,-389.68 187.09,-378.5"/><polygon fill="#000" stroke="#000" points="189.238 -375.73 179.391 -371.821 184.651 -381.018 189.238 -375.73"/></g><g id="node17" class="node"><title>vcl_backend_error</title><ellipse cx="345" cy="-354" fill="none" stroke="#000" rx="76.539" ry="18"/><text x="345" y="-350.3" font-family="Times,serif" font-size="14" text-anchor="middle">vcl_backend_error</text></g><g id="edge21" class="edge"><title>decision1-&gt;vcl_backend_error</title><path fill="none" stroke="#000" d="M263.152,-412.775C277.589,-402.585 297.308,-388.665 313.773,-377.043"/><polygon fill="#000" stroke="#000" points="315.89 -379.832 322.042 -371.206 311.854 -374.113 315.89 -379.832"/></g><g id="node18" class="node"><title>decision4</title><polygon fill="none" stroke="#000" points="160 -298 90.715 -280 160 -262 229.285 -280 160 -298"/><text x="160" y="-276.3" font-family="Times,serif" font-size="14" text-anchor="middle">cacheable?</text></g><g id="edge22" class="edge"><title>vcl_backend_response-&gt;decision4</title><path fill="none" stroke="#000" d="M160,-335.937C160,-327.807 160,-317.876 160,-308.705"/><polygon fill="#000" stroke="#000" points="163.5 -308.441 160 -298.441 156.5 -308.441 163.5 -308.441"/></g><g id="node19" class="node"><title>cache</title><polygon fill="none" stroke="#000" points="143 -210 89 -210 89 -174 143 -174 143 -210"/><text x="116" y="-188.3" font-family="Times,serif" font-size="14" text-anchor="middle">cache</text></g><g id="edge23" class="edge"><title>decision4-&gt;cache</title><path fill="none" stroke="green" d="M152.134,-263.625C145.807,-251.26 136.777,-233.609 129.326,-219.047"/><polygon fill="green" stroke="green" points="132.374 -217.318 124.703 -210.01 126.142 -220.507 132.374 -217.318"/><text x="151.5" y="-232.3" font-family="Times,serif" font-size="14" text-anchor="middle">yes</text></g><g id="node20" class="node"><title>nocache</title><polygon fill="none" stroke="#000" points="247 -210 161 -210 161 -174 247 -174 247 -210"/><text x="204" y="-188.3" font-family="Times,serif" font-size="14" text-anchor="middle">do not cache</text></g><g id="edge24" class="edge"><title>decision4-&gt;nocache</title><path fill="none" stroke="red" d="M167.722,-263.818C172.887,-253.672 179.84,-240.031 186,-228 187.495,-225.081 189.062,-222.026 190.622,-218.988"/><polygon fill="red" stroke="red" points="193.74 -220.578 195.199 -210.084 187.514 -217.377 193.74 -220.578"/><text x="217.5" y="-232.3" font-family="Times,serif" font-size="14" text-anchor="middle">hit-for-pass</text></g><g id="edge25" class="edge"><title>cache-&gt;vcl_deliver</title><path fill="none" stroke="green" d="M124.058,-173.937C128.122,-165.329 133.141,-154.702 137.678,-145.095"/><polygon fill="green" stroke="green" points="140.895 -146.478 142 -135.941 134.565 -143.488 140.895 -146.478"/></g><g id="edge26" class="edge"><title>nocache-&gt;vcl_deliver</title><path fill="none" stroke="red" d="M191.203,-173.937C184.38,-164.84 175.866,-153.489 168.352,-143.469"/><polygon fill="red" stroke="red" points="171.134 -141.345 162.334 -135.445 165.534 -145.545 171.134 -141.345"/></g></g></svg>
